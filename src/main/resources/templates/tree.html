<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Principles Tree</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="https://unpkg.com/htmx.org@1.9.10"></script>
		<style>
			/* Custom tree styles */
			.tree-item {
				position: relative;
				margin-left: 1.5rem;
			}

			.tree-item::before {
				content: "";
				position: absolute;
				top: 0;
				left: -1rem;
				height: 100%;
				border-left: 1px dashed #cbd5e0;
			}

			.tree-item::after {
				content: "";
				position: absolute;
				top: 0.75rem;
				left: -1rem;
				width: 0.5rem;
				border-top: 1px dashed #cbd5e0;
			}

			.tree-item:last-child::before {
				height: 0.75rem;
			}

			/* Active item styles */
			.active-item {
				background-color: #ebf5ff;
			}
			.active-practice {
				background-color: #ebfaf5;
			}
			.active-subpractice {
				background-color: #fdfae5;
			}
		</style>
	</head>
	<body class="bg-gray-100 min-h-screen">
		<div class="container mx-auto p-4">
			<h1 class="text-3xl font-bold text-gray-800 mb-6">Principles Tree</h1>

			<div class="flex flex-col lg:flex-row gap-6">
				<!-- Tree navigation panel -->
				<div class="w-full lg:w-1/3 bg-white p-4 rounded-lg shadow-md h-[calc(100vh-150px)] overflow-auto">
					<h2 class="text-xl font-semibold mb-4 text-gray-700 border-b pb-2">Repository Structure</h2>

					<!-- Empty state message -->
					<div th:if="${principles.isEmpty()}" class="text-gray-500 italic">
						No principles found. Please ensure your repository is correctly indexed.
					</div>

					<!-- Principles tree -->
					<ul th:if="${!principles.isEmpty()}" class="space-y-2">
						<li th:each="entry : ${principles}">
							<div
								class="flex items-center space-x-1 p-2 hover:bg-blue-50 rounded cursor-pointer principle-item"
								hx-get="@{/api/content/principle/{name}(name=${entry.key})}"
								hx-target="#content-panel"
								hx-trigger="click"
								hx-indicator="#loading-indicator"
								th:data-principle-id="${entry.key}"
							>
								<svg
									xmlns="http://www.w3.org/2000/svg"
									class="h-5 w-5 text-blue-600"
									fill="none"
									viewBox="0 0 24 24"
									stroke="currentColor"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"
									/>
								</svg>
								<span class="font-medium" th:text="${entry.value.metadata().name()}"
									>Principle Name</span
								>
							</div>

							<!-- Practices -->
							<ul th:if="${!entry.value.practises().isEmpty()}" class="mt-1 ml-4 space-y-1">
								<li th:each="practice : ${entry.value.practises()}" class="tree-item">
									<div
										class="flex items-center space-x-1 p-1.5 hover:bg-green-50 rounded cursor-pointer practice-item"
										th:hx-get="@{/api/content/practice/{principleName}/{practiceName}(principleName=${entry.key},practiceName=${practice.key})}"
										hx-target="#content-panel"
										hx-trigger="click"
										hx-indicator="#loading-indicator"
										th:data-principle-id="${entry.key}"
										th:data-practice-id="${practice.key}"
									>
										<svg
											xmlns="http://www.w3.org/2000/svg"
											class="h-4 w-4 text-green-600"
											fill="none"
											viewBox="0 0 24 24"
											stroke="currentColor"
										>
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
											/>
										</svg>
										<span class="text-sm" th:text="${practice.value.metadata().name()}"
											>Practice Name</span
										>
									</div>

									<!-- Sub-practices -->
									<ul th:if="${!practice.value.subPractises().isEmpty()}" class="ml-3 mt-1 space-y-1">
										<li th:each="subPractice : ${practice.value.subPractises()}" class="tree-item">
											<div
												class="flex items-center space-x-1 p-1 hover:bg-yellow-50 rounded cursor-pointer subpractice-item"
												th:hx-get="@{/api/content/subpractice/{principleName}/{practiceName}/{subPracticeName}(principleName=${entry.key},practiceName=${practice.key},subPracticeName=${subPractice.key})}"
												hx-target="#content-panel"
												hx-trigger="click"
												hx-indicator="#loading-indicator"
												th:data-principle-id="${entry.key}"
												th:data-practice-id="${practice.key}"
												th:data-subpractice-id="${subPractice.key}"
											>
												<svg
													xmlns="http://www.w3.org/2000/svg"
													class="h-3.5 w-3.5 text-yellow-600"
													fill="none"
													viewBox="0 0 24 24"
													stroke="currentColor"
												>
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
													/>
												</svg>
												<span class="text-xs" th:text="${subPractice.value.metadata().name()}"
													>Sub-Practice Name</span
												>
											</div>
										</li>
									</ul>
								</li>
							</ul>
						</li>
					</ul>
				</div>

				<!-- Content display panel -->
				<div
					class="w-full lg:w-2/3 bg-white p-6 rounded-lg shadow-md h-[calc(100vh-150px)] overflow-auto relative"
				>
					<!-- Loading indicator -->
					<div
						id="loading-indicator"
						class="htmx-indicator absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center"
					>
						<div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
					</div>

					<!-- Initial empty state - will be replaced by htmx content -->
					<div id="content-panel" class="h-full">
						<div class="flex flex-col items-center justify-center h-full text-gray-500">
							<svg
								xmlns="http://www.w3.org/2000/svg"
								class="h-16 w-16 mb-4"
								fill="none"
								viewBox="0 0 24 24"
								stroke="currentColor"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="1"
									d="M8 16l2.879-2.879m0 0a3 3 0 104.243-4.242 3 3 0 00-4.243 4.242zM21 12a9 9 0 11-18 0 9 9 0 0118 0z"
								/>
							</svg>
							<p class="text-lg">Select an item from the tree to view its content</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- JavaScript for highlighting active items -->
		<script>
			document.addEventListener("htmx:afterOnLoad", function () {
				// Clear all active classes first
				document.querySelectorAll(".active-item, .active-practice, .active-subpractice").forEach((el) => {
					el.classList.remove("active-item", "active-practice", "active-subpractice");
				});

				// Get the clicked element
				const clickedElement = htmx.find(htmx.target);

				if (clickedElement.classList.contains("principle-item")) {
					clickedElement.classList.add("active-item");
				} else if (clickedElement.classList.contains("practice-item")) {
					clickedElement.classList.add("active-practice");
				} else if (clickedElement.classList.contains("subpractice-item")) {
					clickedElement.classList.add("active-subpractice");
				}
			});
		</script>
	</body>
</html>
